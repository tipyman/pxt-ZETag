<xml xmlns="https://developers.google.com/blockly/xml"><block type="pxt-on-start" id="s%k5L)DZN*e?/$g/=QpB" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="KB78eW;Pe*Y|1f),zn7," editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="namespace ZETag {" line1="    let Para_array: number[] = []" line2="    let ch_spacing = 0" line3="    let CheckSum = 0" line4="    let o = 0" line5="    let TX_Power_data = 0" line6="    let ch_num = 0" line7="    let Base_frequency = 0" line8="    let Counter2 = 0" line9="" line10="    function Send_Uart_data(data_array: number[], num: number):void {" line11="        o = 0" line12="        for (let n = 0; n &lt;= num - 1; n++) {" line13="            binserial_write(data_array[n])" line14="            basic.pause(5)" line15="        }" line16="    }" line17="" line18="    function binserial_write(text: number): void {" line19="            return;" line20="    }" line21="" line22="/**" line23=" * set channel spacing" line24=" */" line25="    //% blockId=Channel_Spacing block=&quot;Set Channel Space %s (KHz)&quot;" line26="    //% weight=80 blockGap=8" line27="    //% CH_SPACE.min=100 CH_SPACE.max=200 CH_SPACE.defl=100" line28="    export function Set_channel_spacing(CH_SPACE: number) {" line29="        // FF 00 03 F0 64 56; 100KHz設定" line30="        // FF+00+03+F0=1F2 -&gt; 0xf2" line31="        Send_Uart_data([" line32="            0xff," line33="            0x00," line34="            0x03," line35="            0xf0," line36="            CH_SPACE," line37="            (0xf2 + ch_spacing) % 256" line38="        ], 6)" line39="    }" line40="" line41="    //% blockId=Send_data block=&quot;Send ZETag data %data_array %num&quot;" line42="    //% weight=80 blockGap=8" line43="    export function Send_data(data_array: number[], num: number) {" line44="        // 0xff+2+0x80=0x181 -&gt; 0x81" line45="        // FF 00 02 80" line46="        CheckSum = 0x81 + num" line47="        Send_Uart_data([" line48="            0xff," line49="            0x00," line50="            num + 2," line51="            0x80" line52="        ], 4)" line53="        o = 0" line54="        for (let index = 0; index &lt; num; index++) {" line55="            binserial_write(data_array[o])" line56="            basic.pause(5)" line57="            CheckSum = CheckSum + data_array[o]" line58="            o += 1" line59="        }" line60="        binserial_write(CheckSum % 256)" line61="        basic.pause(5)" line62="    }" line63="" line64="    //% blockId=TX_Power block=&quot;TX Power %TX_Power (dB)&quot;" line65="    //% weight=80 blockGap=8" line66="    //% TX_Power.min=1 TX_Power.max=10 TX_Power.defl=10" line67="    export function Set_TX_Power(TX_Power: number) {" line68="        TX_Power_data = TX_Power * 2" line69="        // FF 00 03 41 10 53; 出力8dB設定" line70="        // FF+00+03+41=0x143 -&gt; 0x43" line71="        Send_Uart_data([" line72="            0xff," line73="            0x00," line74="            0x03," line75="            0x41," line76="            TX_Power_data," line77="            (0x43 + TX_Power_data) % 256" line78="        ], 6)" line79="        basic.pause(5)" line80="    }" line81="" line82="    //% blockId=Set_Frequency block=&quot;Set Frequency %Frequency (Hz) %CH_num (ch) %CH_step&quot;" line83="    //% weight=80 blockGap=8" line84="    //% CH_num.min=1 CH_num.max=6 CH_num.defl=2" line85="    //% CH_step.min=1 CH_step.max=2 CH_step.defl=2" line86="    export function Set_Frequency(Frequency: number, CH_num: number, CH_step: number) {" line87="        o = CH_step" line88="        if (CH_num &lt;= 1) {" line89="            ch_num = -1" line90="        } else {" line91="            ch_num = CH_num" line92="        }" line93="        Base_frequency = Frequency" line94="        CheckSum = 0" line95="        Para_array = [" line96="            0xff," line97="            0x00," line98="            0x08 + ch_num," line99="            0x40," line100="            0x01," line101="            Math.idiv(Base_frequency, 16777216)," line102="            Math.idiv(Base_frequency, 65536) % 256," line103="            Math.idiv(Base_frequency, 256) % 256," line104="            Base_frequency % 256," line105="            ch_num," line106="            0," line107="            0," line108="            0," line109="            0," line110="            0," line111="            0," line112="            0" line113="        ]" line114="        if (ch_num &gt;= 2) {" line115="            for (let Counter = 0; Counter &lt;= ch_num - 1; Counter++) {" line116="                Para_array[10 + Counter] = Counter * o" line117="            }" line118="        } else {" line119="            Para_array[4] = 0" line120="        }" line121="        Counter2 = 0" line122="        for (let index2 = 0; index2 &lt; ch_num + 10; index2++) {" line123="            CheckSum = CheckSum + Para_array[Counter2]" line124="            Counter2 += 1" line125="        }" line126="        CheckSum = CheckSum % 256" line127="        Para_array[10 + ch_num] = CheckSum" line128="        Send_Uart_data(Para_array, 11 + ch_num)" line129="    }" line130="}" numlines="131"></mutation></block></statement></block></xml>